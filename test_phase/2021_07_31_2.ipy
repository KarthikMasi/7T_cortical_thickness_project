# coding: utf-8
import nibabel as nib
img = nib.load('/home/local/VANDERBILT/ramadak/CUTTING7T/CUTTING7T/ST7001_v1/7001_341021/501-x-T1_3D_TFEiso0.70-x-T1_3D_TFEiso0.70/rigid_with_slant_mask.nii.gz')
img.affine
np.linalg.inv(img.affine)
import numpy as np
np.linalg.inv(img.affine)
np.linalg.inv(img.affine)[0:3,0:3]
inv_aff = np.linalg.inv(img.affine)
rot = np.linalg.inv(img.affine)[0:3,0:3]
trans = np.dot(rot, inv_aff[0:3,3] - (np.array(img.shape) / 2))
trans
del trans
trans = np.dot(rot, inv_aff[0:3,3] - (np.array(img.shape)))
trans
new_aff= np.eye(4)
new_aff[0:3,3] = trans
new_aff[0:2,3] *= -1
pwd
np.savetxt('macruise_translation.txt',new_aff)
trans = np.dot(rot, inv_aff[0:3,3] - (np.array(img.shape) / 4))
del new_aff
new_aff= np.eye(4)
new_aff[0:3,3] = trans
new_aff[0:2,3] *= -1
np.savetxt('macruise_translation.txt',new_aff)
trans = np.dot(rot, inv_aff[0:3,3] - (np.array(img.shape) / 8))
del new_aff
new_aff= np.eye(4)
new_aff[0:3,3] = trans
new_aff[0:2,3] *= -1
np.savetxt('macruise_translation.txt',new_aff)
trans = np.dot(rot, inv_aff[0:3,3] - (np.array(img.shape) / 16))
new_aff= np.eye(4)
new_aff[0:3,3] = trans
new_aff[0:2,3] *= -1
np.savetxt('macruise_translation.txt',new_aff)
import vtk
vtkreader = vtk.vtkPolyDataReader()
vtkreader.SetFileName('/home/local/VANDERBILT/ramadak/CUTTING7T/CUTTING7T/ST7001_v1/3001_237531/CUTTING7T-x-ST7001_v1-x-3001_237531-x-macruise_v3-x-ef9104ad-c7e9-49a9-9784-8cc548b8ad1b/Surfaces/target_image_GMimg_outerSurf_flipped.vtk')
vtkreader.Update()
polydata = vtkreader.GetOutput()
polydate
polydata
print(polydata)
polydata
polydata.GetCenter?
polydata.GetCenter()
vtkreader.GetFileName()
vtkreader2 = vtk.vtkPolyDataReader()
vtkreader2.SetFileName('surf/lh.gray.flipped.vtk')
lh_gray = vtkreader2.GetOutput()
lh.gray.GetCenter()
lh_gray.GetCenter()
polydata.GetCenter()
normals = vtk.vtkPolyDataNormals()
normals.SetInputConnection(vtkreader.GetOutputPort())
normals.ComputePointNormalsOn()
normals.Update()
points = normals.GetOutput().GetPointData()
points
normals_coords = points.GetNormals()
from vtk.util import numpy_support
np_normals = numpy_support.vtk_to_numpy(normals_coords)
np_normals[1]
size(np_normals)
np_normals.shape
surface_points = normals.GetOutput().GetPoints()
np_surface = numpy_support.vtk_to_numpy(surface_points)
np_surface = numpy_support.vtk_to_numpy(surface_points.GetData())
np_surface.shape
osurf_reader = vtk.vtkPolyDataReader()
osurf_reader.SetFileName('/home/local/VANDERBILT/ramadak/CUTTING7T/CUTTING7T/ST7001_v1/3001_237531/CUTTING7T-x-ST7001_v1-x-3001_237531-x-macruise_v3-x-ef9104ad-c7e9-49a9-9784-8cc548b8ad1b/Surfaces/target_image_GMimg_outerSurf_aligned.vtk')
osurf.Update().GetOutput().GetCenter()
osurf_reader.Update().GetOutput().GetCenter()
osurf_reader.Update()
osurf_reader.GetOutput().GetCenter()
vtkreader.GetFileName()
np.loadtxt('../CUTTING7T/ST7001_v1/3001_237531/CUTTING7T-x-ST7001_v1-x-3001_237531-x-macruise_v3-x-ef9104ad-c7e9-49a9-9784-8cc548b8ad1b/Surfaces_MNI/aff.txt')
aff = np.loadtxt('../CUTTING7T/ST7001_v1/3001_237531/CUTTING7T-x-ST7001_v1-x-3001_237531-x-macruise_v3-x-ef9104ad-c7e9-49a9-9784-8cc548b8ad1b/Surfaces_MNI/aff.txt')
inv_aff = np.linalg.inv(aff)
rot = np.linalg.inv(aff)[0:3,0:3]
img = nib.load('/home/local/VANDERBILT/ramadak/CUTTING7T/CUTTING7T/ST7001_v1/7001_341021/501-x-T1_3D_TFEiso0.70-x-T1_3D_TFEiso0.70/rigid_with_slant_mask.nii.gz')
trans = np.dot(rot, inv_aff[0:3,3] - (np.array(img.shape) / 2))
new_aff= np.eye(4)
new_aff[0:3,3] = trans
new_aff[0:2,3] *= -1
np.savetxt('macruise_translation_with_aff.txt',new_aff)
img_m = nib.load('/home/local/VANDERBILT/ramadak/CUTTING7T/CUTTING7T/ST7001_v1/3001_237531/201-x-t1_structural-x-t1_structural/NIFTI/201_t1_structural.nii.gz')
img_m.get_fdata()
fdata = img_m.get_fdata()
fdata
nib.save(nib.Nifti1Image(fdata,np.eye(4)),'/home/local/VANDERBILT/ramadak/CUTTING7T/CUTTING7T/ST7001_v1/3001_237531/201-x-t1_structural-x-t1_structural/NIFTI/lol.nii.gz')
img_m.affine
np.savetxt?
pwd
np.savetxt('201_affine.txt', img_m.affine)
np.savetxt('201_inv_affine.txt', np.linalg.inv(img_n.affine))
np.savetxt('201_inv_affine.txt', np.linalg.inv(img_m.affine))
inv_img_n = np.linalg.inv(img_n.affine)
inv_img_n = np.linalg.inv(img_m.affine)
id_inv = np.eye(4)
id_inv[0][0] = -1
id_inv[1][1] = -1
id_inv
inv_dot = np.dot(id_inv,inv_img_n)
inv_dot
np.savetxt('201_inv_dot.txt')
np.savetxt('201_inv_dot.txt',inv_dot)
whos
vtkreader.GetFileName()
vtkreader2.GetFileName()
history
%save -r fast_code_jul29 1-107
whos
trk_list
